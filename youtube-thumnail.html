<!DOCTYPE html>
<html>
<head>
    <title>4x4 Canvas with File Upload</title>
</head>
<body>
    <canvas id="canvas" width="800" height="800"></canvas>
    <button id="downloadButton">Download Grid</button>

    <script>
        // Function to draw the 4x4 grid on the canvas
        function drawGrid(cellWidth, cellHeight) {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // Clear the canvas
            ctx.clearRect(0, 0, width, height);

            // Define the grid properties
            const rows = 4;
            const cols = 4;

            // Draw the grid cells with gray background
            ctx.fillStyle = 'gray';
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const x = j * cellWidth;
                    const y = i * cellHeight;
                    ctx.fillRect(x, y, cellWidth, cellHeight);
                    ctx.strokeRect(x, y, cellWidth, cellHeight);
                }
            }

            // Add file upload event to each cell
            canvas.addEventListener('click', function(event) {
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                const colIndex = Math.floor(x / cellWidth);
                const rowIndex = Math.floor(y / cellHeight);
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = 'image/*';
                fileInput.addEventListener('change', function() {
                    const file = fileInput.files[0];
                    const reader = new FileReader();
                    reader.onload = function() {
                        const img = new Image();
                        img.onload = function() {
                            ctx.drawImage(img, colIndex * cellWidth, rowIndex * cellHeight, cellWidth, cellHeight);
                        };
                        img.src = reader.result;
                    };
                    reader.readAsDataURL(file);
                });
                fileInput.click();
            });

            // Add functionality to the Download button
            const downloadButton = document.getElementById('downloadButton');
            downloadButton.addEventListener('click', function() {
                const image = new Image();
                image.onload = function() {
                    const tempCanvas = document.createElement('canvas');
                    tempCanvas.width = width;
                    tempCanvas.height = height;
                    const tempCtx = tempCanvas.getContext('2d');
                    tempCtx.drawImage(image, 0, 0, width, height);
                    const dataURL = tempCanvas.toDataURL('image/png');
                    const downloadLink = document.createElement('a');
                    downloadLink.href = dataURL;
                    downloadLink.download = 'grid.png';
                    downloadLink.click();
                };
                image.src = canvas.toDataURL('image/png');
            });
        }

        // Call the drawGrid function with the desired cell width and height
        drawGrid(250, 250);
    </script>
</body>
</html>
